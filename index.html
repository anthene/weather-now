<html lang="ru">
	<head>
		<title>XHR</title>
		<meta charset="utf-8"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
		<meta name="viewport" content="width=device-width, initial-scale=1"/>
	</head>
	<body>
		<a href="javascript:void(0)" onclick="getWeatherData(fillForm)">Обновить</a>
		
		<h4>Время</h4>
		<div id="dt"></div>
		<h4>Восход</h4>
		<div id="sunrise"></div>
		<h4>Заход</h4>
		<div id="sunset"></div>
		<h4>В общем</h4>
		<div id="main"></div>
		<h4>Температура</h4>
		<div id="main.temp"></div>
		<h4>Давление</h4>
		<div id="pressure"></div>
		<h4>Влажность</h4>
		<div id="humidity"></div>
		<h4>Скорость ветра</h4>
		<div id="wind.speed"></div>
		
		<script type="text/javascript">
			var dict = {
				Thunderstorm: "Гроза",
				Drizzle: "Мелкий дождь",
				Rain: "Дождь",
				Snow: "Снег",
				Atmosphere: "Atmosphere",
				Clear: "Ясно",
				Clouds: "Облачно",
				Extreme: "Extreme",
				Additional: "Additional",
			}
		
			function fillForm(data) {
				document.getElementById("dt").innerHTML = new Date(1000*data.dt);
				document.getElementById("main").innerHTML = dict[data.weather[0].main];
				document.getElementById("main.temp").innerHTML = data.main.temp;
				document.getElementById("pressure").innerHTML = data.main.pressure*0.007500638;
				document.getElementById("humidity").innerHTML = data.main.humidity;
				document.getElementById("wind.speed").innerHTML = data.wind.speed;
				document.getElementById("sunrise").innerHTML = new Date(1000*data.sys.sunrise);
				document.getElementById("sunset").innerHTML = new Date(1000*data.sys.sunset);
			}
		
			function getWeatherData(callback) {
				var xhr = new XMLHttpRequest();

				xhr.open('GET', 'http://api.openweathermap.org/data/2.5/weather?id=524901&units=metric&appid=0da70d33c9a5dfaf3ded356599ea6929', true);
				
				xhr.onreadystatechange = function () {
					if (xhr.readyState != 4) return;
					
					if (xhr.status === 200) {
						callback(JSON.parse(xhr.responseText));
					}
				}

				xhr.send();
			}
			
			function startGetWeatherData() {
				setInterval(function () { getWeatherData(fillForm); }, 60000);
			}
			
			getWeatherData(fillForm);
			<!-- startGetWeatherData(); -->
		</script>
	</body>
</html>
